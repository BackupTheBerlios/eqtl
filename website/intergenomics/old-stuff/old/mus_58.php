<?php
$conv_mus=array();
$conv_mus[1] = array(
/* D1Mit430 */	"0" => 14271356,
/* D1Mit236 */	"17.0242" => 45435458,
/* D1Mit303 */	"28.6108" => 62954170,
/* D1Mit380 */	"36.7049" => 72982363,
/* D1Mit440 */	"49.3329" => 90682603,
/* D1Mit136 */	"54.4366" => 103894727,
/* D19Mit72 */	"67.5109" => 130944135,
/* D1Mit507 */	"86.8901" => 166978064,
/* D1Mit111 */	"90.4541" => 170937673,
/* D1Mit426 */	"101.246" => 182341840,
/* D1Mit155 */	"126.585" => 196255163
);
$conv_mus[10] = array(
/* D10Mit213 */	"0" => 20127245,
/* D10Mit126 */	"22.7257" => 26734074,
/* D10Mit115 */	"29.7604" => 69739444,
/* D10Mit42 */	"34.2937" => 82117849,
/* D10Mit95 */	"45.3032" => 91965451,
/* D10Mit233 */	"57.5665" => 113818252,
/* D10Mit271 */	"67.3762" => 123783002
);
$conv_mus[11] = array(
/* D11Mit71 */	"0" => 6830280,
/* D11Mit231 */	"22.2479" => 35501291,
/* D11Mit86 */	"28.2958" => 54003617,
/* D11Mit4 */	"41.1388" => 68422759,
/* D11Mit36 */	"52.0377" => 83656096 /* substituting non-existing Ensembl data with manual setting */,
/* D11Mit289 */	"60.1191" => 94741466,
/* D11Mit214 */	"88.4879" => 114991785,
/* D11Mit48 */	"93.0236" => 117993078
);
$conv_mus[12] = array(
/* D12Mit221 */	"0" => 36628031,
/* D12Mit201 */	"18.8977" => 73392448,
/* D12Mit4 */	"24.9679" => 80094377,
/* D12Mit7 */	"43.7287" => 17692183 /* substituting non-existing Ensembl data with manual setting */,
/* D12Nds2 */	"47.9542" => 115134928
);
$conv_mus[13] = array(
/* D13Mit14 */	"0" => 24491943 /* substituting non-existing Ensembl data with manual setting */,
/* D13Mit88 */	"22.4002" => 38855131,
/* D13Mit64 */	"25.0398" => 45152335,
/* D13Mit144 */	"92.6866" => 96872492,
/* D13Mit213 */	"101.963" => 109037352,
/* D13Mit260 */	"107.5" => 113155804,
/* D13Mit78 */	"114.058" => 119618032
);
$conv_mus[14] = array(
/* D14Mit109 */	"0" => 13403047,
/* D14Mit127 */	"16.2284" => 31205943 /* substituting non-existing Ensembl data with manual setting */,
/* D14Mit257 */	"35.1642" => 51870488,
/* D14Mit157 */	"40.1578" => 68225521,
/* D14Mit68 */	"48.1898" => 72914117,
/* D14Mit92 */	"52.6944" => 91514647,
# no information on marker 'D14Mit75' - skipped,
/* D14Mit170 */	"76.3319" => 106665012
);
$conv_mus[15] = array(
/* D15Mit11 */	"0" => 9635527,
/* D15Mit143 */	"27.9401" => 51985414,
/* D15Mit26 */	"35.4959" => 55100110,
/* D15Mit67 */	"46.9092" => 70032295,
/* D15Mit171 */	"72.3665" => 89887788,
/* D15Mit35 */	"83.7784" => 103347764
);
$conv_mus[16] = array(
/* D16Mit55 */	"0" => 6242279,
/* D16Mit60 */	"17.2462" => 32704177,
/* D16Mit14 */	"29.2961" => 51385951,
/* D16Mit76 */	"36.316" => 67719505,
/* D16Mit19 */	"43.8641" => 78812001,
/* D16Mit86 */	"76.7276" => 93134312
);
$conv_mus[17] = array(
/* D17Mit245 */	"0" => 12260190,
# no information on marker 'D17Mit10' - skipped,
/* D17Mit180 */	"26.8904" => 51571276,
/* D17Mit185 */	"34.9013" => 68800770,
/* D17Mit93 */	"44.5142" => 74149996,
/* D17Mit72 */	"54.6771" => 79392921,
/* D17Mit123 */	"69.6173" => 93598959
);
$conv_mus[18] = array(
/* D18Mit19 */	"0" => 5041117,
/* D18Mit60 */	"18.6102" => 32648763,
/* D18Mit55 */	"40.4683" => 53317604,
/* D18Mit123 */	"58.4615" => 56130259,
/* D18Mit208 */	"71.1435" => 61085661 /* substituting non-existing Ensembl data with manual setting */,
/* D18Mit186 */	"82.0874" => 72180072,
/* D18Mit144 */	"88.6055" => 85665234
);
$conv_mus[19] = array(
/* D19Mit68 */	"0" => 3645155,
/* D19Mit111 */	"19.2546" => 22081217,
/* D19Mit17 */	"27.2781" => 45626090,
/* D19Mit10 */	"36.3572" => 47227282,
/* D19Mit92 */	"52.044" => 59740927
);
$conv_mus[2] = array(
/* D2Mit1 */	"0" => 3803361,
/* D2Mit32 */	"26.6942" => 25073811 /* substituting non-existing Ensembl data with manual setting */,
/* D2Mit372 */	"41.9781" => 35957187,
/* D2Mit327 */	"58.5612" => 69303093,
/* D2Mit100 */	"75.1003" => 106377525,
/* D2Mit206 */	"75.9378" => 106750096,
/* D2Mit395 */	"83.4664" => 119350649,
/* D2Mit411 */	"96.5577" => 159412163,
/* D2Mit285 */	"108.53" => 152683037,
/* D2Mit147 */	"121.131" => 172220208,
/* D2Mit200 */	"131.39" => 179526405
);
$conv_mus[3] = array(
/* D3Mit203 */	"9.43126" => 26835026,
/* D3Mit307 */	"18.8556" => 39437974,
/* D3Mit25 */	"27.6964" => 56600603,
# no information on marker 'D3Mit244' - skipped,
/* D3Mit101 */	"49.1949" => 96445337,
/* D3Mit57 */	"58.9743" => 115533310,
/* D3Mit254 */	"65.9887" => 131711739,
/* D3Mit44 */	"83.6861" => 147806689,
# no information on marker 'D3Mit19' - skipped
);
$conv_mus[4] = array(
/* D4Mit18 */	"0" => 13937604,
# no information on marker 'D4Mit91' - skipped,
/* D4Mit17 */	"38.5704" => 63026328,
/* D4Mit9 */	"54.3898" => 94736033,
/* D4Mit308 */	"74.6686" => 123838543,
/* D4Mit251 */	"91.3916" => 136483111,
/* D4Mit310 */	"95.9268" => 148070766,
/* D4Mit256 */	"104.577" => 154364548
);
$conv_mus[5] = array(
/* D5Mit346 */	"0" => 4879531,
/* D5Mit130 */	"0" => 41223599,
/* D5Mit387 */	"17.067" => 28676908,
/* D5Mit183 */	"18.8353" => 53728383,
/* D5Mit201 */	"21.8991" => 75550712,
/* D5Mit388 */	"25.9677" => 33660748,
/* D5Mit25 */	"44.3339" => 114333701,
/* D5Mit95 */	"56.6003" => 125309605,
/* D5Mit31 */	"60.2158" => 138998202,
/* D5Mit143 */	"68.7707" => 151804668
);
$conv_mus[6] = array(
/* D6Mit86 */	"0" => 4414884,
/* D6Mit116 */	"12.478" => 25100229,
/* D6Mit183 */	"27.0333" => 53246341,
/* D6Mit69 */	"45.0361" => 83595701,
/* D6Mit36 */	"60.0525" => 104453354,
/* D6Mit328 */	"66.0821" => 112729344,
/* D6Mit289 */	"77.1442" => 128789919,
/* D6Mit14 */	"93.8874" => 145604376
);
$conv_mus[7] = array(
/* D7Mit267 */	"0" => 30331965,
/* D7Mit228 */	"9.29976" => 47279833,
/* D7Mit145 */	"29.4022" => 58658647,
/* D7Mit350 */	"154.588" => 90734599,
/* D7Mit323 */	"159.598" => 108024450,
/* D7Mit44 */	"178.182" => 137094038,
/* D7Mit98 */	"196.707" => 122060781,
/* D7Mit71 */	"211.767" => 138168667,
/* D7Mit259 */	"225.542" => 151943409
);
$conv_mus[8] = array(
/* D8Mit124 */	"0" => 14723160,
/* D8Mit258 */	"18.8078" => 34959364,
# no information on marker 'D8Mit259' - skipped,
/* D8Mit178 */	"34.3879" => 73569352,
/* D8Mit15 */	"44.6993" => 96697525,
/* D8Mit88 */	"64.0921" => 117360795,
/* D8Mit36 */	"72.5414" => 123831138
);
$conv_mus[9] = array(
/* D9Mit126 */	"0" => 22960837,
/* D9Mit2 */	"9.81338" => 37202486,
/* D9Mit129 */	"12.9206" => 43693207,
/* D9Mit336 */	"27.5804" => 65425671,
/* D9Mit269 */	"37.8933" => 87838840,
/* D9Mit355 */	"43.4046" => 98719954,
/* D9Mit201 */	"52.4185" => 117345284,
/* D9Mit151 */	"76.4526" => 121386992
);
$conv_mus["X"] = array(
/* DXMit192 */	"0" => 48229420 /* substituting non-existing Ensembl data with manual setting */,
/* DXMit74 */	"4.27659" => 64192138,
/* DXMit64 */	"25.5645" => 103381013,
/* DXMit173 */	"28.3028" => 126915843,
/* DXMit132 */	"34.6255" => 138191357,
/* DXMit223 */	"50.7676" => 163741515
);

if (!empty($conv_mus["X"])) $conv_mus[20]=$conv_mus["X"];
if (!empty($conv_mus["Y"])) $conv_mus[20 + 1]=$conv_mus["Y"];

/**
 * Centimorgan to Basepairs conversion.
 * @param unknown_type $chr
 * @param unknown_type $cm
 */
function cM2bp($chr,$cm=0) {
	global $conv;
	$chrconv=$conv[$chr];
	$cMmin=$bpmin=-1;
	$cMmax=$bpmax=-1;
	$actbp=$lastbp=-1;
	$actcM=$lastcM=-1;
	$found=FALSE;
	$prevcM=$secondCM=-1;
	$prevbp=$secondBP=-1;
	if (empty($chrconv)) {
		echo "<p>marker.php: No information for chromosome '$chr'.</p>\n";
		return (-2);
	} elseif (!is_array($chrconv)) {
		echo "<p>func_conversion_55.php: Internal error. (chr '$chr').</p>\n";
		return (-3);
	} else {
		foreach($chrconv as $cMorgan=>$bp) {
			if (-1 == $cMmin) {
				$cMmin=$cMmax=$cMorgan;
				$bpmin=$bpmax=$bp;
			}
			else {
				if (-1 == $secondCM && !empty($cMorgan)) {
					$secondCM=$cMorgan;
					$secondBP=$bp;
				}
				if ($bp>$bpmax) {
					$bpmax=$bp;
					$cMmax=$cMorgan;
				}
			}

			if ($found) {
			}
			else {
				if ($cm<$cMorgan) {
					$found=TRUE;
					if (-1 == $actcM) {
						$actcM=$cMorgan;
						$actbp=$bp;
						$lastcM=$prevcM;
						$lastbp=$prevbp;
					}
					break;
					break;
				}
			}
			$prevcM=$cMorgan;
			$prevbp=$bp;
		}

		if ($cm<=$cMmin) {
			// cM requested upstream of first marker
			$ret=$bpmin+($cm-$cMmin)/($secondCM-$cMmin)*($secondBP-$bpmin);
		} elseif (-1 != $actcM) {
			$ret=$lastbp+($cm-$lastcM)/($actcM-$lastcM)*($actbp-$lastbp);
		} else {
			// downstream of rightmost marker
			if ($cMmax==$cMmin) {
				// we only haev a single marker - helpless?
				// FIMXE: implement extra point (0,0)
				echo "<p>cMmax==cMmin ($cMmax==$cMmin)\n<p>";
				$ret=-1;
			}
			else {
				// extrapolating from the first to the last marker
				$ret=$bpmin+($cm-$cMmin)/($cMmax-$cMmin)*($bpmax-$bpmin);
			}
		}
		return(round($ret));
	}
}

/**
 * Basepairs to Centimorgan conversion.
 * @param unknown_type $chr
 * @param unknown_type $cm
 */
function bp2cM($chr,$bpInput=0) {
	global $conv;
	$chrconv=$conv[$chr];
	$cMmin=$bpmin=-1;
	$cMmax=$bpmax=-1;
	$actbp=$lastbp=-1;
	$actcM=$lastcM=-1;
	$found=FALSE;
	$prevcM=$secondCM=-1;
	$prevbp=$secondBP=-1;
	if (empty($chrconv)) {
		echo "<p>marker.php: No information for chromosome '$chr'.</p>\n";
		return (-2);
	} elseif (!is_array($chrconv)) {
		echo "<p>func_conversion_55.php: Internal error. (chr '$chr').</p>\n";
		return (-3);
	} else {
		foreach($chrconv as $cMorgan=>$bp) {
			if (-1 == $cMmin) {
				# first time this loop was entered
				# this will also be the minimal value
				$cMmin=$cMmax=$cMorgan;
				$bpmin=$bpmax=$bp;
			}
			else {
				if (-1 == $secondCM && !empty($cMorgan)) {
					$secondCM=$cMorgan;
					$secondBP=$bp;
				}
				if ($bp>$bpmax) {
					$bpmax=$bp;
					$cMmax=$cMorgan;
				}
				if (! $bp >= $bpmin) { // avoiding the lt sign
					echo  "Suddenly found bp value at $bp smaller than current minimum at $bpmin.";
					$bpmin=$bp;
					$cMmin=$cMorgan;
				}
			}

			if ($found) {
			}
			else {
				if ($bpInput >= $bp) { // avoiding the lt sign for web presentation
				}
				else {
					$found=TRUE;
					if (-1 == $actcM) {
						$actcM=$cMorgan;
						$actbp=$bp;
						$lastcM=$prevcM;
						$lastbp=$prevbp;
					}
					break;
				}
			}
			$prevcM=$cMorgan;
			$prevbp=$bp;
		}

		if ($bpInput<=$bpmin) {
			// bp requested upstream of first marker
			$ret=$cMmin+($bpInput-$bpmin)/($secondBP-$bpmin)*($secondCM-$cMmin);
		} elseif (-1 != $actcM) {
			$ret=$lastcM+($bpInput-$lastbp)/($actbp-$lastbp)*($actcM-$lastcM);
		} else {
			// downstream of rightmost marker
			if ($cMmax==$cMmin) {
				// we only have a single marker - helpless?
				// FIMXE: implement extra point (0,0)
				echo "<p>cMmax==cMmin ($cMmax==$cMmin)\n<p>";
				$ret=-1;
			}
			else {
				// extrapolating from the first to the last marker
				$ret=$cMmin+($bpInput-$bpmin)/($bpmax-$bpmin)*($cMmax-$cMmin);
			}
		}
		return($ret);
	}
}
// This conversion is based on ensembl database ensembl_mart_58 on host martdb.ensembl.org:5316
?>
