<?php
$conv_mus=array();
$conv_mus[1] = array(
/* D1Mit430 */	"0" => 14271356,
/* D1Mit236 */	"17.0242" => 45435458,
/* D1Mit303 */	"28.6108" => 62954170,
/* D1Mit380 */	"36.7049" => 72982363,
/* D1Mit440 */	"49.3329" => 90682603,
/* D1Mit136 */	"54.4366" => 103894727,
/* D19Mit72 */	"67.5109" => 130944135,
/* D1Mit507 */	"86.8901" => 166978064,
/* D1Mit111 */	"90.4541" => 170937673,
/* D1Mit426 */	"101.246" => 182341840,
/* D1Mit155 */	"126.585" => 196255163
);
$conv_mus[10] = array(
/* D10Mit213 */	"0" => 20127245,
/* D10Mit126 */	"22.7257" => 26734074,
/* D10Mit115 */	"29.7604" => 69739444,
/* D10Mit42 */	"34.2937" => 82117849,
/* D10Mit95 */	"45.3032" => 91965451,
/* D10Mit233 */	"57.5665" => 113818252,
/* D10Mit271 */	"67.3762" => 123783002
);
$conv_mus[11] = array(
/* D11Mit71 */	"0" => 6830280,
/* D11Mit231 */	"22.2479" => 35501291,
/* D11Mit86 */	"28.2958" => 54003617,
/* D11Mit4 */	"41.1388" => 68422759,
/* D11Mit36 */	"52.0377" => 83656096 /* substituting non-existing Ensembl data with manual setting */,
/* D11Mit289 */	"60.1191" => 94741466,
/* D11Mit214 */	"88.4879" => 114991785,
/* D11Mit48 */	"93.0236" => 117993078
);
$conv_mus[12] = array(
/* D12Mit221 */	"0" => 36628031,
/* D12Mit201 */	"18.8977" => 73392448,
/* D12Mit4 */	"24.9679" => 80094377,
/* D12Mit7 */	"43.7287" => 17692183 /* substituting non-existing Ensembl data with manual setting */,
/* D12Nds2 */	"47.9542" => 115134928
);
$conv_mus[13] = array(
/* D13Mit14 */	"0" => 24491943 /* substituting non-existing Ensembl data with manual setting */,
/* D13Mit88 */	"22.4002" => 38855131,
/* D13Mit64 */	"25.0398" => 45152335,
/* D13Mit144 */	"92.6866" => 96872492,
/* D13Mit213 */	"101.963" => 109037352,
/* D13Mit260 */	"107.5" => 113155804,
/* D13Mit78 */	"114.058" => 119618032
);
$conv_mus[14] = array(
/* D14Mit109 */	"0" => 13403047,
/* D14Mit127 */	"16.2284" => 31205943 /* substituting non-existing Ensembl data with manual setting */,
/* D14Mit257 */	"35.1642" => 51870488,
/* D14Mit157 */	"40.1578" => 68225521,
/* D14Mit68 */	"48.1898" => 72914117,
/* D14Mit92 */	"52.6944" => 91514647,
# no information on marker 'D14Mit75' - skipped,
/* D14Mit170 */	"76.3319" => 106665012
);
$conv_mus[15] = array(
/* D15Mit11 */	"0" => 9635527,
/* D15Mit143 */	"27.9401" => 51985414,
/* D15Mit26 */	"35.4959" => 55100110,
/* D15Mit67 */	"46.9092" => 70032295,
/* D15Mit171 */	"72.3665" => 89887788,
/* D15Mit35 */	"83.7784" => 103347764
);
$conv_mus[16] = array(
/* D16Mit55 */	"0" => 6242279,
/* D16Mit60 */	"17.2462" => 32704177,
/* D16Mit14 */	"29.2961" => 51385951,
/* D16Mit76 */	"36.316" => 67719505,
/* D16Mit19 */	"43.8641" => 78812001,
/* D16Mit86 */	"76.7276" => 93134312
);
$conv_mus[17] = array(
/* D17Mit245 */	"0" => 12260190,
# no information on marker 'D17Mit10' - skipped,
/* D17Mit180 */	"26.8904" => 51571276,
/* D17Mit185 */	"34.9013" => 68800770,
/* D17Mit93 */	"44.5142" => 74149996,
/* D17Mit72 */	"54.6771" => 79392921,
/* D17Mit123 */	"69.6173" => 93598959
);
$conv_mus[18] = array(
/* D18Mit19 */	"0" => 5041117,
/* D18Mit60 */	"18.6102" => 32648763,
/* D18Mit55 */	"40.4683" => 53317604,
/* D18Mit123 */	"58.4615" => 56130259,
/* D18Mit208 */	"71.1435" => 61085661 /* substituting non-existing Ensembl data with manual setting */,
/* D18Mit186 */	"82.0874" => 72180072,
/* D18Mit144 */	"88.6055" => 85665234
);
$conv_mus[19] = array(
/* D19Mit68 */	"0" => 3645155,
/* D19Mit111 */	"19.2546" => 22081217,
/* D19Mit17 */	"27.2781" => 45626090,
/* D19Mit10 */	"36.3572" => 47227282,
/* D19Mit92 */	"52.044" => 59740927
);
$conv_mus[2] = array(
/* D2Mit1 */	"0" => 3803361,
/* D2Mit32 */	"26.6942" => 25073811 /* substituting non-existing Ensembl data with manual setting */,
/* D2Mit372 */	"41.9781" => 35957187,
/* D2Mit327 */	"58.5612" => 69303093,
/* D2Mit100 */	"75.1003" => 106377525,
/* D2Mit206 */	"75.9378" => 106750096,
/* D2Mit395 */	"83.4664" => 119350649,
/* D2Mit411 */	"96.5577" => 159412163,
/* D2Mit285 */	"108.53" => 152683037,
/* D2Mit147 */	"121.131" => 172220208,
/* D2Mit200 */	"131.39" => 179526405
);
$conv_mus[3] = array(
/* D3Mit203 */	"9.43126" => 26835026,
/* D3Mit307 */	"18.8556" => 39437974,
/* D3Mit25 */	"27.6964" => 56600603,
# no information on marker 'D3Mit244' - skipped,
/* D3Mit101 */	"49.1949" => 96445337,
/* D3Mit57 */	"58.9743" => 115533310,
/* D3Mit254 */	"65.9887" => 131711739,
/* D3Mit44 */	"83.6861" => 147806689,
# no information on marker 'D3Mit19' - skipped
);
$conv_mus[4] = array(
/* D4Mit18 */	"0" => 13937604,
# no information on marker 'D4Mit91' - skipped,
/* D4Mit17 */	"38.5704" => 63026328,
/* D4Mit9 */	"54.3898" => 94736033,
/* D4Mit308 */	"74.6686" => 123838543,
/* D4Mit251 */	"91.3916" => 136483111,
/* D4Mit310 */	"95.9268" => 148070766,
/* D4Mit256 */	"104.577" => 154364548
);
$conv_mus[5] = array(
/* D5Mit346 */	"0" => 4879531,
/* D5Mit130 */	"0" => 41223599,
/* D5Mit387 */	"17.067" => 28676908,
/* D5Mit183 */	"18.8353" => 53728383,
/* D5Mit201 */	"21.8991" => 75550712,
/* D5Mit388 */	"25.9677" => 33660748,
/* D5Mit25 */	"44.3339" => 114333701,
/* D5Mit95 */	"56.6003" => 125309605,
/* D5Mit31 */	"60.2158" => 138998202,
/* D5Mit143 */	"68.7707" => 151804668
);
$conv_mus[6] = array(
/* D6Mit86 */	"0" => 4414884,
/* D6Mit116 */	"12.478" => 25100229,
/* D6Mit183 */	"27.0333" => 53246341,
/* D6Mit69 */	"45.0361" => 83595701,
/* D6Mit36 */	"60.0525" => 104453354,
/* D6Mit328 */	"66.0821" => 112729344,
/* D6Mit289 */	"77.1442" => 128789919,
/* D6Mit14 */	"93.8874" => 145604376
);
$conv_mus[7] = array(
/* D7Mit267 */	"0" => 30331965,
/* D7Mit228 */	"9.29976" => 47279833,
/* D7Mit145 */	"29.4022" => 58658647,
/* D7Mit350 */	"154.588" => 90734599,
/* D7Mit323 */	"159.598" => 108024450,
/* D7Mit44 */	"178.182" => 137094038,
/* D7Mit98 */	"196.707" => 122060781,
/* D7Mit71 */	"211.767" => 138168667,
/* D7Mit259 */	"225.542" => 151943409
);
$conv_mus[8] = array(
/* D8Mit124 */	"0" => 14723160,
/* D8Mit258 */	"18.8078" => 34959364,
# no information on marker 'D8Mit259' - skipped,
/* D8Mit178 */	"34.3879" => 73569352,
/* D8Mit15 */	"44.6993" => 96697525,
/* D8Mit88 */	"64.0921" => 117360795,
/* D8Mit36 */	"72.5414" => 123831138
);
$conv_mus[9] = array(
/* D9Mit126 */	"0" => 22960837,
/* D9Mit2 */	"9.81338" => 37202486,
/* D9Mit129 */	"12.9206" => 43693207,
/* D9Mit336 */	"27.5804" => 65425671,
/* D9Mit269 */	"37.8933" => 87838840,
/* D9Mit355 */	"43.4046" => 98719954,
/* D9Mit201 */	"52.4185" => 117345284,
/* D9Mit151 */	"76.4526" => 121386992
);
$conv_mus["X"] = array(
/* DXMit192 */	"0" => 48229420 /* substituting non-existing Ensembl data with manual setting */,
/* DXMit74 */	"4.27659" => 64192138,
/* DXMit64 */	"25.5645" => 103381013,
/* DXMit173 */	"28.3028" => 126915843,
/* DXMit132 */	"34.6255" => 138191357,
/* DXMit223 */	"50.7676" => 163741515
);

if (!empty($conv_mus["X"])) $conv_mus[20]=$conv_mus["X"];
if (!empty($conv_mus["Y"])) $conv_mus[20 + 1]=$conv_mus["Y"];

$conv_rattus=array();
$conv_rattus[1] = array(
/* D1Rat167 */	"0" => 4404878,
/* D1Rat10 */	"33.0626" => 25271050,
/* D1Rat257 */	"59.6914" => 54516880,
/* D1Rat265 */	"78.5345" => 90449000,
/* D1Rat36 */	"104.874" => 128874535,
/* D1Rat131 */	"114.263" => 145648743,
/* D1Rat49 */	"119.419" => 157497945,
/* D1Rat56 */	"127.678" => 172926307,
/* D1Rat66 */	"132.416" => 183946847,
/* D1Rat70 */	"147.621" => 205041048,
/* D1Rat188 */	"154.974" => 206567644,
/* D1Rat301 */	"189.253" => 234595191,
/* D1Rat86 */	"202.64" => 259173327,
/* D1Rat126 */	"207.498" => 262779963,
/* D1Rat235 */	"248.1" => 248100601
);
$conv_rattus[10] = array(
/* D10Rat96 */	"0" => 6172611,
/* D10Rat43 */	"22.6322" => 23428128,
/* D10Rat37 */	"35.1" => 35131432,
/* D10Rat78 */	"43.0871" => 43361251,
/* D10Rat81 */	"49.6" => 49618847,
/* D10Rat29 */	"61.413" => 68842891,
/* D10Rat219 */	"75.0213" => 81986621,
/* D10Rat18 */	"90.339" => 91208778,
/* D10Rat7 */	"111.837" => 105886242
);
$conv_rattus[11] = array(
/* D11Rat87 */	"0" => 1270722,
/* D11Rat76 */	"17.9566" => 27445617,
/* D11Rat68 */	"38.504" => 46793415,
/* D11Rat46 */	"64.838" => 81091342
);
$conv_rattus[12] = array(
/* D12Rat57 */	"0" => 3438583,
/* D12Mit2 */	"22.1012" => 20932560,
/* D12Rat23 */	"27.3156" => 25367107,
/* D12Mgh5 */	"29.1" => 29130181,
/* D12Rat20 */	"71.7127" => 44254904
);
$conv_rattus[13] = array(
/* D13Rat88 */	"0" => 42627611,
/* D13Rat42 */	"30.1037" => 74560243,
/* D13Rat54 */	"51.5722" => 9.45e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D13Rat49 */	"59.2759" => 104400153
);
$conv_rattus[14] = array(
/* D14Rat1 */	"0" => 4895895,
/* D14Rat72 */	"2.35071" => 7697708,
/* D14Rat78 */	"10.1528" => 17564856,
/* D14Rat99 */	"21.6084" => 2.64e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D14Rat14 */	"33.4" => 33448038,
/* D14Rat62 */	"52.8614" => 68771632,
/* D14Rat49 */	"82.3438" => 9.82e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D14Rat110 */	"90.5594" => 107119264
);
$conv_rattus[15] = array(
/* D15Rat73 */	"0" => 766501,
/* D15Rat80 */	"25.5" => 25506389,
/* D15Rat123 */	"63.0094" => 58412002,
/* D15Rat99 */	"85.077" => 81981179,
/* D15Rat28 */	"110.034" => 107378191
);
$conv_rattus[16] = array(
/* D16Rat12 */	"0" => 350122,
/* D16Rat19 */	"26.4375" => 35339930,
/* D16Mgh5 */	"50.2" => 50266029,
/* D16Rat53 */	"51.7903" => 66606253,
/* D16Rat13 */	"83.2969" => 77968643,
/* D16Rat89 */	"84.0747" => 89009136
);
$conv_rattus[17] = array(
/* D17Rat6 */	"0" => 16053310,
/* D17Rat117 */	"25.9841" => 31007409,
/* D17Rat98 */	"48.3653" => 64047700,
/* D17Rat51 */	"84.828" => 96587775,
/* D17Rat47 */	"85.1001" => 8.50724e+07 /* substituting non-existing Ensembl data with manual setting */
);
$conv_rattus[18] = array(
/* D18Rat108 */	"0" => 11593055,
/* D18Rat116 */	"16.0006" => 40600399,
/* D18Rat74 */	"69.278" => 7.12e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D18Rat76 */	"70.5592" => 79643542
);
$conv_rattus[19] = array(
/* D19Rat19 */	"0" => 7813538,
/* D19Rat10 */	"36.4485" => 40109361,
/* D19Rat8 */	"47.7195" => 4.36e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D19Mit11 */	"54.3603" => 49565031
);
$conv_rattus[2] = array(
/* D2Rat3 */	"0" => 8678734,
/* D2Rat17 */	"34.4586" => 48244850,
/* D2Rat174 */	"47.0821" => 60124624,
/* D2Rat177 */	"64.0351" => 108159563,
/* D2Rat256 */	"78.2211" => 145455614,
/* D2Rat44 */	"95.4989" => 181710215,
/* D2Rat185 */	"163.667" => 238139979,
/* D2Mgh16 */	"175.409" => 2.505e+08 /* substituting non-existing Ensembl data with manual setting */,
/* D2Mgh12 */	"210.6" => 210636009
);
$conv_rattus[20] = array(
/* D20Rat31 */	"0" => 10410005,
/* D20Rat7 */	"22.184" => 26064462,
/* D20Rat16 */	"47.5229" => 46690376
);
$conv_rattus[3] = array(
/* D3Rat58 */	"0" => 10829519,
/* D3Rat44 */	"31.8953" => 41420306,
/* D3Rat81 */	"68.7441" => 9.52e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D3Rat126 */	"79.1218" => 120891188,
/* D3Rat139 */	"135.988" => 161202737,
/* D3Rat147 */	"143.5" => 143492509
);
$conv_rattus[4] = array(
/* D4Mgh22 */	"0" => 4410369,
/* D4Rat222 */	"8.852" => 19044128,
/* D4Mgh14 */	"20.8858" => 36592629,
/* D4Rat25 */	"39.9092" => 65822169,
/* D4Rat177 */	"59.3719" => 114073977,
/* D4Rat196 */	"85.8815" => 143753496,
/* D4Got131 */	"102.213" => 162283990,
/* D4Got130 */	"107.008" => 166051146,
/* D4Mgh11 */	"109.814" => 171204378,
/* D4Rat84 */	"118.176" => 185398416,
/* D4Rat80 */	"132.3" => 132262560,
/* D4Mgh30 */	"154.9" => 154937061
);
$conv_rattus[5] = array(
/* D5Rat208 */	"0" => 7966797,
/* D5Rat73 */	"9.11139" => 25602275,
/* D5Rat6 */	"52.5" => 52530708,
/* D5Rat77 */	"66.6881" => 8.06e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D5Rat83 */	"94.5619" => 125563751,
/* D5Rat171 */	"110.656" => 147509595,
/* D5Rat40 */	"124.075" => 1.567e+08 /* substituting non-existing Ensembl data with manual setting */,
/* D5Rat178 */	"132.574" => 1.61449e+08 /* substituting non-existing Ensembl data with manual setting */,
/* D5Rat50 */	"139.239" => 1.65e+08 /* substituting non-existing Ensembl data with manual setting */
);
$conv_rattus[6] = array(
/* D6Rat40 */	"0" => 1301953,
/* D6Rat47 */	"8.7901" => 14627484,
/* D6Rat31 */	"47.3906" => 4.34e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D6Rat24 */	"63.8" => 63795021,
/* D6Rat100 */	"99.8353" => 100709526,
/* D6Mgh9 */	"123.3" => 123341445,
/* D6Rat79 */	"142.387" => 131029752
);
$conv_rattus[7] = array(
/* D7Rat154 */	"0" => 21224426,
/* D7Rat151 */	"30.1" => 30146703,
/* D7Rat103 */	"35.9024" => 44462830,
/* D7Mgh7 */	"53.7378" => 74244787,
/* D7Rat18 */	"75.8163" => 103612740,
/* D7Rat139 */	"89.9001" => 89944922,
/* D7Rat4 */	"107.671" => 134614034
);
$conv_rattus[8] = array(
/* D8Rat56 */	"0" => 8294861,
/* D8Rat163 */	"25.5693" => 31508525,
/* D8Rat41 */	"43.3313" => 50354909,
/* D8Rat104 */	"67.3312" => 8.44e+07 /* substituting non-existing Ensembl data with manual setting */,
/* D8Rat62 */	"70" => 70009520,
/* D8Mgh3 */	"91.181" => 103684650,
/* D8Rat2 */	"151.023" => 123415272
);
$conv_rattus[9] = array(
/* D9Rat135 */	"0" => 7e+06 /* substituting non-existing Ensembl data with manual setting */,
/* D9Rat130 */	"19.7245" => 20102047,
/* D9Rat76 */	"34.6017" => 33496795,
/* D9Rat63 */	"39.7" => 39691558,
/* D9Rat24 */	"46.2" => 46242655,
/* D9Rat16 */	"58.5" => 58516720,
/* D9Rat19 */	"59.5" => 59463565,
/* D9Rat5 */	"105.599" => 85186878,
/* D9Rat71 */	"121.831" => 106234734
);
$conv_rattus["X"] = array(
/* DXRat47 */	"0" => 26298304,
/* DXRat57 */	"24.1252" => 83729959,
/* DXRat130 */	"49.4121" => 1.585e+08 /* substituting non-existing Ensembl data with manual setting */
);

if (!empty($conv_rattus["X"])) $conv_rattus[21]=$conv_rattus["X"];
if (!empty($conv_rattus["Y"])) $conv_rattus[21 + 1]=$conv_rattus["Y"];

/*$species = array(
 "Rattus norvegicus" =>"conv_rattus",
 "Mus musculus"=>"conv_mus");*/
$speciesArray = array("Rattus norvegicus","Mus musculus");

/**
 * returns the suported target species mus and rat in an array.
 * @return the suported target species mus and rat in an array
 */
function getSupportedTargetSpecies()
{
	global $speciesArray;
	return $speciesArray;
}
/**
 * Private function to get the basepair to chromosome mapping for a requested species.
 * @param $chr
 * @param $species_name
 */
function getCromosomeConv($chr, $species_name){
	/*global $conv_rattus;
	 global $conv_mus;
	 //global $species;
	 foreach($species as $name => $conv_table){
		if($name==$species_name){
		//print_r($$conv_table);
		echo "</br>Hier</br>".$conv_table;
		$$conv_table;
		echo "</br>Hier</br>";
		print_r($conv_table[1]);
		echo '</br>';
		$conv_table[$chr];
		}
		}*/
	// FIXME: couldn't this be more dynamic? (loop??)
	//echo '<b>'.$species_name.'</b>';
	if($species_name=="Rattus norvegicus"){
		global $conv_rattus;
		return $conv_rattus[$chr];
	}elseif ($species_name=="Mus musculus"){
		global $conv_mus;
		return $conv_mus[$chr];
	}else{
		trigger_error('The requested species is currently not available... (just mus and rat)');
	}

}
/**
 * Centimorgan to Basepairs conversion.
 * @param unknown_type $chr
 * @param unknown_type $cm
 */
function cM2bp($chr,$cm=0,$species_name) {
	$chrconv=getCromosomeConv($chr,$species_name);
	$cMmin=$bpmin=-1;
	$cMmax=$bpmax=-1;
	$actbp=$lastbp=-1;
	$actcM=$lastcM=-1;
	$found=FALSE;
	$prevcM=$secondCM=-1;
	$prevbp=$secondBP=-1;
	if (empty($chrconv)) {
		echo "<p>marker.php: No information for chromosome '$chr'.</p>\n";
		return (-2);
	} elseif (!is_array($chrconv)) {
		echo "<p>func_conversion_55.php: Internal error. (chr '$chr').</p>\n";
		return (-3);
	} else {
		foreach($chrconv as $cMorgan=>$bp) {
			if (-1 == $cMmin) {
				$cMmin=$cMmax=$cMorgan;
				$bpmin=$bpmax=$bp;
			}
			else {
				if (-1 == $secondCM && !empty($cMorgan)) {
					$secondCM=$cMorgan;
					$secondBP=$bp;
				}
				if ($bp>$bpmax) {
					$bpmax=$bp;
					$cMmax=$cMorgan;
				}
			}

			if ($found) {
			}
			else {
				if ($cm<$cMorgan) {
					$found=TRUE;
					if (-1 == $actcM) {
						$actcM=$cMorgan;
						$actbp=$bp;
						$lastcM=$prevcM;
						$lastbp=$prevbp;
					}
					break;
					break;
				}
			}
			$prevcM=$cMorgan;
			$prevbp=$bp;
		}

		if ($cm<=$cMmin) {
			// cM requested upstream of first marker
			$ret=$bpmin+($cm-$cMmin)/($secondCM-$cMmin)*($secondBP-$bpmin);
		} elseif (-1 != $actcM) {
			$ret=$lastbp+($cm-$lastcM)/($actcM-$lastcM)*($actbp-$lastbp);
		} else {
			// downstream of rightmost marker
			if ($cMmax==$cMmin) {
				// we only haev a single marker - helpless?
				// FIMXE: implement extra point (0,0)
				echo "<p>cMmax==cMmin ($cMmax==$cMmin)\n<p>";
				$ret=-1;
			}
			else {
				// extrapolating from the first to the last marker
				$ret=$bpmin+($cm-$cMmin)/($cMmax-$cMmin)*($bpmax-$bpmin);
			}
		}
		return(round($ret));
	}
}

/**
 * Basepairs to Centimorgan conversion.
 * @param unknown_type $chr
 * @param unknown_type $cm
 */
function bp2cM($chr,$bpInput=0,$species_name) {
	$chrconv=getCromosomeConv($chr,$species_name);
	/* OLD STEFFEN CODE
	 * global $conv;
	 $chrconv=$conv[$chr];*/
	$cMmin=$bpmin=-1;
	$cMmax=$bpmax=-1;
	$actbp=$lastbp=-1;
	$actcM=$lastcM=-1;
	$found=FALSE;
	$prevcM=$secondCM=-1;
	$prevbp=$secondBP=-1;
	if (empty($chrconv)) {
		echo "<p>marker.php: No information for chromosome '$chr'.</p>\n";
		return (-2);
	} elseif (!is_array($chrconv)) {
		echo "<p>func_conversion_55.php: Internal error. (chr '$chr').</p>\n";
		return (-3);
	} else {
		foreach($chrconv as $cMorgan=>$bp) {
			if (-1 == $cMmin) {
				# first time this loop was entered
				# this will also be the minimal value
				$cMmin=$cMmax=$cMorgan;
				$bpmin=$bpmax=$bp;
			}
			else {
				if (-1 == $secondCM && !empty($cMorgan)) {
					$secondCM=$cMorgan;
					$secondBP=$bp;
				}
				if ($bp>$bpmax) {
					$bpmax=$bp;
					$cMmax=$cMorgan;
				}
				if (! $bp >= $bpmin) { // avoiding the lt sign
					echo  "Suddenly found bp value at $bp smaller than current minimum at $bpmin.";
					$bpmin=$bp;
					$cMmin=$cMorgan;
				}
			}

			if ($found) {
			}
			else {
				if ($bpInput >= $bp) { // avoiding the lt sign for web presentation
				}
				else {
					$found=TRUE;
					if (-1 == $actcM) {
						$actcM=$cMorgan;
						$actbp=$bp;
						$lastcM=$prevcM;
						$lastbp=$prevbp;
					}
					break;
				}
			}
			$prevcM=$cMorgan;
			$prevbp=$bp;
		}

		if ($bpInput<=$bpmin) {
			// bp requested upstream of first marker
			$ret=$cMmin+($bpInput-$bpmin)/($secondBP-$bpmin)*($secondCM-$cMmin);
		} elseif (-1 != $actcM) {
			$ret=$lastcM+($bpInput-$lastbp)/($actbp-$lastbp)*($actcM-$lastcM);
		} else {
			// downstream of rightmost marker
			if ($cMmax==$cMmin) {
				// we only have a single marker - helpless?
				// FIMXE: implement extra point (0,0)
				echo "<p>cMmax==cMmin ($cMmax==$cMmin)\n<p>";
				$ret=-1;
			}
			else {
				// extrapolating from the first to the last marker
				$ret=$cMmin+($bpInput-$bpmin)/($bpmax-$bpmin)*($cMmax-$cMmin);
			}
		}
		return($ret);
	}
}
// This conversion is based on ensembl database ensembl_mart_58 on host martdb.ensembl.org:5316
?>
